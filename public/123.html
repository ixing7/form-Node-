<html>
<head>
    <style>
        body{
            background-color: #bfa;
        }
        canvas{
            border: 5px solid;
        }
    </style>
</head>
<body>
<table
        border
        cellspacing="5"
>
    <tr>
        <th>1</th>
        <th>2</th>
        <th>3</th>
    </tr>
    <tr>
        <td>4</td>
        <td>5</td>
        <td>6</td>
    </tr>
</table>
<canvas id="canvas" width="100" height="100">
    不支持canvas
</canvas>

<form id="registSubmit" action="/img" method="post" target="nm_iframe">
    <input id="file1"  onchange="aa()" type="file" name="file1">
    <input  onchange ="aa()" type="text" name="text2">
    <input id="subm" type="submit" value="提交">
    <p>上传预览图：</p>
    <img id="yulan" src="" alt="">
</form>
<iframe id="id_iframe" name="nm_iframe" style="display:none;"></iframe>
<script>
   function aa (e){
       console.log(e);
   }
   document.querySelector('#subm').onclick = e=>{
       e.preventDefault()
   }
   document.querySelector('#file1').onchange =function (e){
       console.log(e);
       console.log(this.files[0]);
       var formdata = new FormData();
       formdata.append('user', this.files[0]);
               const res = new  FileReader()
               res.readAsArrayBuffer(this.files[0])
       const file = this.files[0]
               res.onload = function(blob){
                   console.log(blob);
                   console.log(this.result);
                   const obj_url = window.URL.createObjectURL(file);
                   yulan.src=obj_url
               }
       const xml = new XMLHttpRequest()
       xml.open('POST','./img')
       console.log(formdata,'上传了');
       xml.send(formdata)


   }




    var canvas = document.getElementById("canvas");
    const context = canvas.getContext('2d')
    context.fillText('你好',50,50)
//默认自己上传
    // canvas.toBlob(function(blob) {
    //     var newImg = document.createElement("img"),
    //         url = URL.createObjectURL(blob);
    //     console.log(blob);
    //     newImg.onload = function() {
    //         // no longer need to read the blob so it's revoked
    //         URL.revokeObjectURL(url);
    //
    //     };
    //     const res = new  FileReader(blob)
    //     res.readAsArrayBuffer(blob) //有待改进?
    //     res.onload = function(e){
    //         console.log(e);
    //         console.log(this.result);
    //
    //         var formdata = new FormData();
    //         formdata.append('user', blob);
    //         formdata.append('use2r', 2);
    //
    //         // const res = new  FileReader()
    //         // res.readAsArrayBuffer(this.files[0])
    //         // res.onload = function(blob){
    //         //
    //         // }
    //         const xml = new XMLHttpRequest()
    //         xml.open('POST','./img')
    //         console.log(formdata,'上传了');
    //         xml.send(formdata)
    //
    //
    //     }
    //     console.log(res);
    //     newImg.src = url;
    //     document.body.appendChild(newImg);
    // });
</script>
</body>
</html>
